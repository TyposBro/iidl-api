# {PATH_TO_THE_PROJECT}/supervisord.conf

[supervisord]
nodaemon=true                             ; Run supervisord in the foreground
user=root                                 ; Optional: run supervisor as root if needed for permissions

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"  ; Command to start nginx, keep it in foreground
autostart=true                            ; Start nginx when supervisor starts
autorestart=true                          ; Restart nginx if it crashes
priority=10                               ; Lower priority means it starts earlier if desired
stdout_logfile=/dev/stdout                ; Redirect stdout to Docker logs
stdout_logfile_maxbytes=0                 ; Disable log rotation for stdout
stderr_logfile=/dev/stderr                ; Redirect stderr to Docker logs
stderr_logfile_maxbytes=0                 ; Disable log rotation for stderr

[program:nodejs_api]
command=node /usr/src/app/backend/src/server.js ; Command to start your Node.js API
directory=/usr/src/app/backend                  ; Working directory for the Node.js app
autostart=true                                  ; Start Node.js app when supervisor starts
autorestart=true                                ; Restart Node.js app if it crashes
priority=20                                     ; Higher priority means it starts after nginx (if dependencies matter)
environment=NODE_ENV="production",PORT="8001"   ; Set environment variables for Node app
                                                ; MONGODB_URI, JWT_SECRET, etc., will be passed
                                                ; to the Docker container at runtime and will be
                                                ; available to all processes started by supervisor.
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0